!function(){let e=()=>{let e=document.querySelector(".alert");e&&e.parentElement.removeChild(e)},t=(t,o,a=7)=>{e();let s=document.createElement("div");s.className=`alert alert--${t}`,s.textContent=o,document.body.insertAdjacentElement("afterbegin",s),window.setTimeout(e,1e3*a)},o=async(e,o)=>{try{let a=await fetch("/api/v1/users/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:o})}),s=await a.json();if(!a.ok)throw Error(s.message||"Login failed");"success"===s.status&&(t("success","Logged in successfully"),window.setTimeout(()=>{location.assign("/")},1500))}catch(e){t("error",e.message)}},a=async()=>{try{let e=await fetch("/api/v1/users/logout",{method:"GET"}),t=await e.json();if(!e.ok)throw Error(t.message||"Logout failed");"success"===t.status&&location.assign("/")}catch(e){t("error","Error logging out! Try again.")}},s=async(e,o)=>{try{let a="password"===o?"/api/v1/users/updateMyPassword":"/api/v1/users/updateMe",s={};"password"===o&&(s["Content-Type"]="application/json");let n="password"===o?JSON.stringify(e):e,r=await fetch(a,{method:"PATCH",headers:s,body:n,credentials:"include"}),d=await r.json();if(!r.ok)throw Error(d.message||"Update failed");"success"===d.status&&(t("success",`${o.toUpperCase()} Data updated successfully`),"data"===o&&window.setTimeout(()=>location.reload(),1500))}catch(e){t("error",e.message)}},n=document.getElementById("book-tour"),r=Stripe("pk_test_51ROgQwR2MLdmVeqdh6UCoA5H1Fp5sqDrNleru4qFPfFbHlfbOykjnKIFquiycuMfqRSh9OHOk8XGoq8LZFY67A8200pAWpxCi1"),d=async e=>{try{let t=await fetch(`/api/v1/bookings/checkout-session/${e}`,{credentials:"include"});if(!t.ok){let e=await t.json();throw Error(e.message||"Failed to get checkout session")}let o=await t.json();await r.redirectToCheckout({sessionId:o.session.id})}catch(e){console.log(e),n&&(n.textContent="Book your tour now!"),t("error",e.message)}},c=document.getElementById("map"),l=document.querySelector(".form--login"),i=document.querySelector(".nav__el--logout"),u=document.querySelector(".form-user-data"),m=document.querySelector(".form-user-password"),p=document.getElementById("book-tour");if(c){var g=JSON.parse(c.dataset.locations);mapboxgl.accessToken="pk.eyJ1Ijoic3B5Y29uIiwiYSI6ImNtYWNnbXA2aDAydDQyc3NiMjFjOWp2OWIifQ.ACLbyRQl_vuy0L1FV4K9rQ";let e=new mapboxgl.Map({container:"map",style:"mapbox://styles/spycon/cmacp4vzx00o401qy1aba2iov",scrollZoom:!1}),t=new mapboxgl.LngLatBounds;g.forEach(o=>{let a=document.createElement("div");a.className="marker",new mapboxgl.Marker({element:a,anchor:"bottom"}).setLngLat(o.coordinates).addTo(e),new mapboxgl.Popup({offset:30}).setLngLat(o.coordinates).setHTML(`<p> ${o.day}: ${o.description}</p>`).addTo(e),t.extend(o.coordinates)}),e.fitBounds(t,{padding:{top:200,bottom:150,left:200,right:200}})}l&&l.addEventListener("submit",e=>{e.preventDefault(),o(document.getElementById("email").value,document.getElementById("password").value)}),i&&i.addEventListener("click",a),u&&u.addEventListener("submit",e=>{e.preventDefault();let t=new FormData;t.append("name",document.getElementById("name").value),t.append("email",document.getElementById("email").value),t.append("photo",document.getElementById("photo").files[0]),s(t,"data")}),m&&m.addEventListener("submit",async e=>{e.preventDefault(),document.querySelector(".btn--save-password").textContent="Updating...";let o=document.getElementById("password-current").value,a=document.getElementById("password").value,n=document.getElementById("password-confirm").value;if(a!==n)return void t("error","New and confirm passwords are not the same!");await s({passwordCurrent:o,password:a,passwordConfirm:n},"password"),document.querySelector(".btn--save-password").textContent="Save password",document.getElementById("password-current").value="",document.getElementById("password").value="",document.getElementById("password-confirm").value=""}),p&&p.addEventListener("click",e=>{e.preventDefault(),e.target.textContent="Processing...";let{tourId:t}=e.target.dataset;d(t)});let y=document.querySelector("body").dataset.alert;alert&&t("success",y,20)}();